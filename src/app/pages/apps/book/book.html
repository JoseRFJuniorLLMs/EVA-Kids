<div class="books-container" [class.dark-mode]="isDarkMode">
  <!-- Header com mascote -->
  <div class="books-header">
    <div class="header-mascot">
      <span class="mascot-emoji bounce">ğŸ“š</span>
    </div>
    <h1 class="header-title">Biblioteca Magica</h1>
    <p class="header-subtitle">Escolha uma aventura para comecar!</p>
  </div>

  <!-- Tabs -->
  <mat-tab-group
    class="kids-tabs"
    [(selectedIndex)]="selectedTab"
    (selectedIndexChange)="onTabChange($event)"
    animationDuration="300ms">

    <!-- TAB 1: Livros Interativos -->
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="tab-emoji">ğŸ®</span>
        <span class="tab-text">Livros Interativos</span>
      </ng-template>

      <div class="tab-content">
        <!-- Table View - Lista de livros por nivel -->
        <div *ngIf="showTable" class="interactive-list">
          <!-- Filtros e controles -->
          <div class="controls-bar">
            <div class="filter-group">
              <span class="filter-emoji">ğŸ¯</span>
              <label for="levelFilter">Nivel:</label>
              <select id="levelFilter" class="kids-select" (change)="filterByLevel($event)">
                <option value="">Todos</option>
                <option *ngFor="let level of uniqueLevels" [value]="level">
                  {{ getLevelEmoji(level) }} {{ level }}
                </option>
              </select>
            </div>

            <div class="nav-buttons">
              <button class="nav-btn" (click)="previousPage()" [disabled]="page === 0" matTooltip="Pagina anterior">
                <span>â¬…ï¸</span>
              </button>
              <span class="page-indicator">Pagina {{ page + 1 }}</span>
              <button class="nav-btn" (click)="nextPage()" matTooltip="Proxima pagina">
                <span>â¡ï¸</span>
              </button>
            </div>

            <div class="action-buttons">
              <button class="action-btn upload-btn" (click)="uploadFile.click()" matTooltip="Carregar arquivo">
                <span>ğŸ“</span> Carregar
              </button>
              <input type="file" #uploadFile (change)="loadFile($event)" accept=".txt" style="display: none;" />

              <button class="action-btn saved-btn" (click)="showSavedTexts = !showSavedTexts" matTooltip="Meus textos salvos">
                <span>{{ showSavedTexts ? 'ğŸ“‹' : 'ğŸ’¾' }}</span> Salvos
              </button>
            </div>
          </div>

          <!-- Saved texts panel -->
          <div *ngIf="showSavedTexts" class="saved-texts-panel">
            <h3><span>ğŸ’¾</span> Meus Textos Salvos</h3>
            <div class="saved-texts-grid" *ngIf="savedTexts.length > 0">
              <div *ngFor="let text of savedTexts"
                   class="saved-text-card"
                   (click)="openSavedText(text)">
                <span class="card-emoji">ğŸ“„</span>
                <span class="card-title">{{ text.fileName }}</span>
                <span class="card-progress">Pagina {{ text.pageRead }}</span>
              </div>
            </div>
            <p *ngIf="savedTexts.length === 0" class="empty-message">
              Nenhum texto salvo ainda! ğŸ“
            </p>
          </div>

          <!-- Books grid -->
          <div class="books-grid">
            <div *ngFor="let text of filteredTexts; let i = index"
                 class="book-card"
                 (click)="selectText(i)"
                 matTooltip="{{ text.text.split('. ')[0] }}">
              <div class="book-level">
                <span class="level-emoji">{{ getLevelEmoji(text.level) }}</span>
                <span class="level-text">{{ text.level }}</span>
              </div>
              <div class="book-info">
                <h3 class="book-prime">{{ text.prime }}</h3>
                <p class="book-target">{{ text.target }}</p>
              </div>
              <div class="book-preview">
                {{ text.text.split('. ')[0] }}...
              </div>
            </div>
          </div>
        </div>

        <!-- Reading View -->
        <div *ngIf="!showTable" class="reading-view" [class.dark-mode]="isDarkMode" [class.dyslexic-mode]="isDyslexicMode">
          <!-- Reading controls -->
          <div class="reading-controls">
            <button class="control-btn back-btn" (click)="goBackToList()" matTooltip="Voltar para lista">
              <span>ğŸ”™</span>
            </button>

            <button class="control-btn play-btn" (click)="toggleReading()" [class.playing]="isReading">
              <span>{{ isReading ? 'â¸ï¸' : 'â–¶ï¸' }}</span>
              <span class="btn-text">{{ isReading ? 'Pausar' : 'Ouvir' }}</span>
            </button>

            <div class="accessibility-controls">
              <button class="acc-btn" (click)="toggleCaptions()" [class.active]="showCaptions" matTooltip="Legenda">
                <span>ğŸ’¬</span>
              </button>
              <button class="acc-btn" (click)="toggleDarkMode()" [class.active]="isDarkMode" matTooltip="Modo escuro">
                <span>{{ isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™' }}</span>
              </button>
              <button class="acc-btn" (click)="toggleDyslexicMode()" [class.active]="isDyslexicMode" matTooltip="Fonte dislexia">
                <span>ğŸ”¤</span>
              </button>
              <button class="acc-btn" (click)="applyBeeLineReader()" [class.active]="isBeeLineActive" matTooltip="BeeLine">
                <span>ğŸŒˆ</span>
              </button>
              <button class="acc-btn" (click)="increaseTextSize()" matTooltip="Aumentar texto">
                <span>ğŸ”+</span>
              </button>
              <button class="acc-btn" (click)="decreaseTextSize()" matTooltip="Diminuir texto">
                <span>ğŸ”-</span>
              </button>
            </div>

            <div class="voice-selector">
              <span>ğŸ—£ï¸</span>
              <select (change)="onVoiceChange($event)" class="kids-select">
                <option *ngFor="let voice of voices" [value]="voice.name">
                  {{ voice.name.split(' ')[0] }}
                </option>
              </select>
            </div>
          </div>

          <!-- Text container -->
          <div #textContainer class="text-container" [class.dark-mode]="isDarkMode" [class.dyslexic-mode]="isDyslexicMode">
          </div>

          <!-- Captions -->
          <div class="caption-container" *ngIf="showCaptions && currentSentence" #captionContainer [class.dark-mode]="isDarkMode">
            {{ currentSentence }}
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- TAB 2: Biblioteca EPUB -->
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="tab-emoji">ğŸ“–</span>
        <span class="tab-text">Biblioteca EPUB</span>
      </ng-template>

      <div class="tab-content">
        <!-- EPUB Gallery View -->
        <div *ngIf="!selectedEbook" class="epub-gallery">
          <div class="gallery-header">
            <h2><span>ğŸ“š</span> Escolha seu livro!</h2>
          </div>

          <div class="ebooks-grid">
            <div *ngFor="let ebook of ebooks"
                 class="ebook-card"
                 (click)="selectEbook(ebook)"
                 matTooltip="{{ ebook.title }} por {{ ebook.author }}">
              <div class="ebook-cover">
                <img [src]="ebook.cover" [alt]="ebook.title" />
              </div>
              <div class="ebook-info">
                <h3 class="ebook-title">{{ ebook.title }}</h3>
                <p class="ebook-author">{{ ebook.author }}</p>
                <span class="ebook-pages">{{ ebook.pageCount }} paginas</span>
              </div>
            </div>
          </div>

          <div *ngIf="ebooks.length === 0" class="empty-library">
            <span class="empty-emoji">ğŸ“­</span>
            <p>A biblioteca esta vazia!</p>
            <p class="empty-hint">Adicione livros em assets/epub/</p>
          </div>
        </div>

        <!-- EPUB Reader View -->
        <div *ngIf="selectedEbook" class="epub-reader">
          <!-- Reader controls -->
          <div class="epub-controls">
            <button class="control-btn back-btn" (click)="closeEpubReader()" matTooltip="Voltar para biblioteca">
              <span>ğŸ”™</span>
            </button>

            <div class="epub-title-bar">
              <span class="book-emoji">ğŸ“–</span>
              <span class="epub-current-title">{{ selectedEbook.title }}</span>
              <span class="page-info">Pagina {{ currentPage }} / {{ totalPages }}</span>
            </div>

            <div class="epub-nav">
              <button class="nav-btn" (click)="epubPrevPage()" matTooltip="Pagina anterior">
                <span>â¬…ï¸</span>
              </button>

              <button class="control-btn play-btn" (click)="toggleEpubReading()" [class.playing]="isEpubReading">
                <span>{{ isEpubReading ? 'â¸ï¸' : 'â–¶ï¸' }}</span>
                <span class="btn-text">{{ isEpubReading ? 'Pausar' : 'Ouvir' }}</span>
              </button>

              <button class="nav-btn" (click)="epubNextPage()" matTooltip="Proxima pagina">
                <span>â¡ï¸</span>
              </button>
            </div>
          </div>

          <!-- EPUB display area -->
          <div id="epub-display-area" class="epub-display"></div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
