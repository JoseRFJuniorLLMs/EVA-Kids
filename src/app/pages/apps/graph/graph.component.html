<div class="graph-page">
  <!-- Tela de Loading Divertida -->
  <div class="loading-screen" *ngIf="isLoading">
    <div class="loading-content">
      <div class="loading-emoji">ğŸŒˆ</div>
      <div class="loading-spinner">
        <span class="spinner-dot"></span>
        <span class="spinner-dot"></span>
        <span class="spinner-dot"></span>
      </div>
      <p class="loading-text">{{ loadingMessage }}</p>
      <div class="loading-emojis">
        <span>ğŸ“š</span>
        <span>âœ¨</span>
        <span>ğŸ¯</span>
        <span>ğŸŒŸ</span>
      </div>
    </div>
  </div>

  <!-- Conteudo Principal -->
  <div class="main-content" *ngIf="!isLoading" @fadeIn>
    <!-- Cabecalho com Estatisticas -->
    <header class="graph-header">
      <div class="header-left">
        <span class="header-emoji">ğŸ—ºï¸</span>
        <h1 class="header-title">Mapa de Palavras</h1>
      </div>

      <div class="stats-container">
        <!-- Palavras Conhecidas -->
        <div class="stat-card known">
          <span class="stat-emoji">â­</span>
          <div class="stat-info">
            <span class="stat-value">{{ knownWords }}</span>
            <span class="stat-label">Sei</span>
          </div>
        </div>

        <!-- Palavras para Aprender -->
        <div class="stat-card tolearn">
          <span class="stat-emoji">ğŸ¯</span>
          <div class="stat-info">
            <span class="stat-value">{{ wordsToLearn }}</span>
            <span class="stat-label">Vou aprender</span>
          </div>
        </div>

        <!-- Progresso -->
        <div class="progress-section">
          <div class="progress-label">
            <span>ğŸ† Meu Progresso</span>
            <span class="progress-percent">{{ progressPercent }}%</span>
          </div>
          <mat-progress-bar
            mode="determinate"
            [value]="progressPercent"
            color="accent">
          </mat-progress-bar>
        </div>
      </div>
    </header>

    <!-- Area do Grafo -->
    <div class="graph-container">
      <div class="network-wrapper" #network></div>

      <!-- Dica de Ajuda -->
      <div class="help-tip" *ngIf="showHelpTip" @fadeIn>
        <span class="tip-emoji">ğŸ’¡</span>
        <p class="tip-text">
          Clique em uma palavra para ouvir!<br>
          Clique duas vezes para ver mais detalhes.
        </p>
        <button class="tip-close" (click)="dismissHelpTip()">âœ•</button>
      </div>

      <!-- Info da Palavra Selecionada -->
      <div class="selected-word-panel" *ngIf="selectedNode" @fadeIn>
        <div class="selected-header">
          <span class="selected-emoji">ğŸ“–</span>
          <span class="selected-title">Palavra Selecionada</span>
        </div>
        <p class="selected-word">{{ selectedNode.label }}</p>
        <div class="selected-actions">
          <button
            class="action-btn listen"
            (click)="speakWord(selectedNode.label)"
            [disabled]="isSpeaking"
            matTooltip="Ouvir palavra">
            <span class="btn-emoji">{{ isSpeaking ? 'ğŸ”Š' : 'ğŸ”ˆ' }}</span>
            <span class="btn-text">Ouvir</span>
          </button>
          <button
            class="action-btn relation"
            (click)="speakWordWithRelation(selectedNode.label)"
            [disabled]="isSpeaking"
            matTooltip="Ouvir com relacao">
            <span class="btn-emoji">ğŸ”—</span>
            <span class="btn-text">Relacao</span>
          </button>
        </div>
      </div>

      <!-- Indicador de Audio -->
      <div class="speaking-indicator" *ngIf="isSpeaking">
        <span class="speaking-emoji">ğŸ”Š</span>
        <span class="speaking-text">Falando: {{ currentWord }}</span>
        <button class="stop-btn" (click)="stopAudio()" matTooltip="Parar">
          ğŸ›‘
        </button>
      </div>
    </div>

    <!-- Barra de Controles -->
    <footer class="graph-controls">
      <button
        class="control-btn primary"
        (click)="speakRandomWord()"
        [disabled]="isSpeaking"
        matTooltip="Aprender palavra nova!">
        <span class="btn-emoji">ğŸ²</span>
        <span class="btn-label">Palavra Nova</span>
      </button>

      <button
        class="control-btn secondary"
        (click)="centerGraph()"
        matTooltip="Centralizar mapa">
        <span class="btn-emoji">ğŸ¯</span>
        <span class="btn-label">Centralizar</span>
      </button>

      <button
        class="control-btn"
        [class.active]="physicsEnabled"
        (click)="togglePhysics()"
        matTooltip="{{ physicsEnabled ? 'Parar movimento' : 'Animar' }}">
        <span class="btn-emoji">{{ physicsEnabled ? 'â¸ï¸' : 'â–¶ï¸' }}</span>
        <span class="btn-label">{{ physicsEnabled ? 'Parar' : 'Animar' }}</span>
      </button>

      <button
        class="control-btn stop"
        (click)="stopAudio()"
        *ngIf="isSpeaking"
        matTooltip="Parar audio">
        <span class="btn-emoji">ğŸ›‘</span>
        <span class="btn-label">Parar</span>
      </button>
    </footer>

    <!-- Legenda -->
    <div class="legend-panel">
      <h4 class="legend-title">ğŸ¨ Legenda</h4>
      <div class="legend-items">
        <div class="legend-item">
          <span class="legend-shape star"></span>
          <span class="legend-text">Palavra Priming</span>
        </div>
        <div class="legend-item">
          <span class="legend-shape diamond"></span>
          <span class="legend-text">Palavra Alvo</span>
        </div>
        <div class="legend-item">
          <span class="legend-shape circle"></span>
          <span class="legend-text">Outras Palavras</span>
        </div>
      </div>
    </div>
  </div>
</div>
